import socket
import time
import os
import random

# Currently set to oim-dev environment's ODE
UDP_IP = os.getenv('DOCKER_HOST_IP')
UDP_PORT = 44910
#MESSAGE = "001338000817a780000089680500204642b342b34802021a15a955a940181190acd0acd20100868555c555c00104342aae2aae002821a155715570"

# Spats with all optional elements
#MESSAGE = "0013809F661A802E2F8C3B786CCA82761DB9407A00005E9E02000186A0225A0804080C1480811BEACD0ACD0ACD2ACD1EAD980F0080000006408087F5668566856695668F56CC078040000003206046FAB342B342B34AB347AB6603C020000001904021FD59A159A159A559A3D5B301E010000000C80410FEACD0ACD0ACD2ACD1EAD980F008000000640A087F5668566856695668F56CC0780400000030780400000030"
#MESSAGE = "001380A2661A802E2F8C3B786CCA82761DB9407A00005E9E02000186A0225A00041480811BEACD0ACD0ACD2ACD1EAD980F0080000006408087F5668566856695668F56CC078040000003206046FAB342B342B34AB347AB660BC020000001BC040000001904021FD59A159A159A559A3D5B301E010000000C80410FEACD0ACD0ACD2ACD1EAD980F008000000640A087F5668566856695668F56CC078040000003078040000003"
#MESSAGE = "001380B3661A802E2F8C3B786CCA82761DB9407A00005E9E02000186A0225A00041480811BEACD0ACD0ACD2ACD1EAD982F0080000006F0100000006408087F5668566856695668F56CC17804000000378080000003206046FAB342B342B34AB347AB660BC020000001BC040000001904021FD59A159A159A559A3D5B301E010000000C80410FEACD0ACD0ACD2ACD1EAD980F008000000640A087F5668566856695668F56CC078040000003178040000003780800000030"
MESSAGE = "001380E1661A802E2F8C3B786CCA82761DB9407A00005E9E02000186A0225A00041480819BEACD0ACD0ACD2ACD1EAD982F37D4019005E2FA2019008BC020000001BC040000001902031FD59A159A159A559A3D5B305E6FA803200BC5F440320117804000000378080000003206066FAB342B342B34AB347AB6603CDF500640117804000000378080000003208063FAB342B342B34AB347AB6603CDF5006401078040000003201063FAB342B342B34AB347AB6603CDF5006401078040000003205063FAB342B342B34AB347AB6603CDF5006401078040000003178040000003780800000030"

print("UDP target IP:", UDP_IP)
print("UDP target port:", UDP_PORT)
#print("message:", MESSAGE)

sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM) # UDP

interval = 0.1

while True:
  rand = random.randint(0, 1)
  jitter = -0.09 if rand == 0 else 0.07
  sleepTime = interval + jitter
  time.sleep(sleepTime)
  print(f"sending SPaT every {sleepTime} seconds")
  sock.sendto(bytes.fromhex(MESSAGE), (UDP_IP, UDP_PORT))
